# Итоговый проект «ValutaTrade Hub», Хлыстиков Валерий М25-555.

Комплексная консольная платформа для управления виртуальным портфелем фиатных и криптовалют с получением котировок в реальном времени.

Проект реализован в рамках учебного курса Python (НИЯУ МИФИ).

## Основные возможности

- **Управление активами**: регистрация пользователей и ведение мультивалютных кошельков.
- **Торговые операции**: покупка и продажа валют (BTC, ETH, SOL, EUR, RUB, GBP) за базовую валюту (USD).
- **Парсер курсов**: автоматическое получение актуальных данных через внешние API (CoinGecko и ExchangeRate-API).
- **Мультивалютная оценка**: просмотр общей стоимости портфеля с пересчетом в любую поддерживаемую валюту (например, `--base RUB`).
- **Логирование**: детальная трассировка всех операций в файл `logs/valutatrade.log`.
- **История котировок**: сохранение исторических данных о курсах в `exchange_rates.json`.

## Архитектура и паттерны

Система построена на принципах модульности и включает:
- **Core Service**: Бизнес-логика, модели данных и обработка транзакций.
- **Parser Service**: Изолированный сервис для работы с внешними API.
- **Singleton**: Единые точки доступа к настройкам (`SettingsLoader`) и базе данных (`DatabaseManager`).
- **Decorators**: Автоматическое логирование доменных операций через `@log_action`.
- **Custom Exceptions**: Иерархия собственных исключений для надежной обработки ошибок.

## Файловая структура

```text
finalproject_Khlystikov_M25-555/
├── data/                    # Хранилище JSON (БД)
│   ├── users.json           # Список пользователей
│   ├── portfolios.json      # Кошельки и активы
│   ├── rates.json           # Кэш последних курсов (Snapshot)
│   └── exchange_rates.json  # История изменений курсов (Журнал)
├── logs/                    # Автоматические логи операций
├── valutatrade_hub/         # Исходный код пакета
│   ├── cli/                 # Интерфейс командной строки
│   ├── core/                # Бизнес-логика (модели, валюты, исключения)
│   ├── infra/               # Инфраструктура (Settings, Database Manager)
│   ├── parser_service/      # Сервис сбора данных из внешних API
│   ├── decorators.py        # Логирование @log_action
│   └── logging_config.py    # Конфигурация ротации логов
├── main.py                  # Точка входа
├── pyproject.toml           # Настройки Poetry и проекта
└── Makefile                 # Команды автоматизации
```

## Команды CLI

### Управление аккаунтом:
* `register --username <name> --password <pass>` — регистрация (начисляется бонус 1000 USD).
* `login --username <name> --password <pass>` — вход в систему.
* `logout` — выход из текущей сессии.

### Работа с курсами:
* `update-rates` — принудительное обновление данных из внешних API в локальный кэш.
* `show-rates [--top N]` — показать актуальные курсы из кэша (топ N самых дорогих или все).
* `get-rate --from <CODE> --to <CODE>` — получить курс конкретной пары.

### Торговля и Портфель:
* `buy --currency <CODE> --amount <float>` — покупка валюты за USD из кошелька.
* `sell --currency <CODE> --amount <float>` — продажа валюты (выручка зачисляется в USD).
* `show-portfolio [--base <CODE>]` — общая стоимость всех активов в выбранной валюте (например, в RUB).

## Сборка и запуск проекта

| Команда | Описание |
| :--- | :--- |
| `make install` | Установка зависимостей проекта |
| `make lint` | Проверка кода с помощью ruff |
| `project` | Запуск приложения (команда Poetry) |
| `make build` | Сборка проекта в пакет |
| `make publish` | Публикация пакета |

все JSON-файлы лежат в каталоге data (настраивается data_directory)
rates.json должен быть в data/rates.json

---
**Разработчик:** Хлыстиков Валерий 
**Группа:** М25-555  
**Курс:** Программирование на Python (НИЯУ МИФИ)